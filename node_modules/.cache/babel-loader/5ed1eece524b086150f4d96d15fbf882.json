{"ast":null,"code":"/* @license\n * Copyright 2020 Google LLC. All Rights Reserved.\n * Licensed under the Apache License, Version 2.0 (the 'License');\n * you may not use this file except in compliance with the License.\n * You may obtain a copy of the License at\n *\n *     http://www.apache.org/licenses/LICENSE-2.0\n *\n * Unless required by applicable law or agreed to in writing, software\n * distributed under the License is distributed on an 'AS IS' BASIS,\n * WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.\n * See the License for the specific language governing permissions and\n * limitations under the License.\n */\nimport { Color } from 'three';\nimport { TextureInfo, TextureUsage } from './texture-info.js';\nimport { $correlatedObjects, $onUpdate, $sourceObject, ThreeDOMElement } from './three-dom-element.js';\nconst $threeMaterials = Symbol('threeMaterials');\nconst $baseColorTexture = Symbol('baseColorTexture');\nconst $metallicRoughnessTexture = Symbol('metallicRoughnessTexture');\n/**\n * PBR material properties facade implementation for Three.js materials\n */\n\nexport class PBRMetallicRoughness extends ThreeDOMElement {\n  constructor(onUpdate, gltf, pbrMetallicRoughness, correlatedMaterials) {\n    super(onUpdate, pbrMetallicRoughness, correlatedMaterials); // Assign glTF default values\n\n    if (pbrMetallicRoughness.baseColorFactor == null) {\n      pbrMetallicRoughness.baseColorFactor = [1, 1, 1, 1];\n    }\n\n    if (pbrMetallicRoughness.roughnessFactor == null) {\n      pbrMetallicRoughness.roughnessFactor = 1;\n    }\n\n    if (pbrMetallicRoughness.metallicFactor == null) {\n      pbrMetallicRoughness.metallicFactor = 1;\n    }\n\n    const {\n      baseColorTexture: gltfBaseColorTexture,\n      metallicRoughnessTexture: gltfMetallicRoughnessTexture\n    } = pbrMetallicRoughness;\n    const {\n      map,\n      metalnessMap\n    } = correlatedMaterials.values().next().value;\n    this[$baseColorTexture] = new TextureInfo(onUpdate, TextureUsage.Base, map, correlatedMaterials, gltf, gltfBaseColorTexture ? gltfBaseColorTexture : null);\n    this[$metallicRoughnessTexture] = new TextureInfo(onUpdate, TextureUsage.MetallicRoughness, metalnessMap, correlatedMaterials, gltf, gltfMetallicRoughnessTexture ? gltfMetallicRoughnessTexture : null);\n  }\n\n  get [$threeMaterials]() {\n    return this[$correlatedObjects];\n  }\n\n  get baseColorFactor() {\n    return this[$sourceObject].baseColorFactor;\n  }\n\n  get metallicFactor() {\n    return this[$sourceObject].metallicFactor;\n  }\n\n  get roughnessFactor() {\n    return this[$sourceObject].roughnessFactor;\n  }\n\n  get baseColorTexture() {\n    return this[$baseColorTexture];\n  }\n\n  get metallicRoughnessTexture() {\n    return this[$metallicRoughnessTexture];\n  }\n\n  setBaseColorFactor(rgba) {\n    const color = new Color();\n\n    if (rgba instanceof Array) {\n      color.fromArray(rgba);\n    } else {\n      color.set(rgba).convertSRGBToLinear();\n    }\n\n    for (const material of this[$threeMaterials]) {\n      material.color.set(color);\n\n      if (rgba instanceof Array) {\n        material.opacity = rgba[3];\n      } else {\n        rgba = [0, 0, 0, material.opacity];\n        color.toArray(rgba);\n      }\n    }\n\n    const pbrMetallicRoughness = this[$sourceObject];\n    pbrMetallicRoughness.baseColorFactor = rgba;\n    this[$onUpdate]();\n  }\n\n  setMetallicFactor(value) {\n    for (const material of this[$threeMaterials]) {\n      material.metalness = value;\n    }\n\n    const pbrMetallicRoughness = this[$sourceObject];\n    pbrMetallicRoughness.metallicFactor = value;\n    this[$onUpdate]();\n  }\n\n  setRoughnessFactor(value) {\n    for (const material of this[$threeMaterials]) {\n      material.roughness = value;\n    }\n\n    const pbrMetallicRoughness = this[$sourceObject];\n    pbrMetallicRoughness.roughnessFactor = value;\n    this[$onUpdate]();\n  }\n\n} //# sourceMappingURL=pbr-metallic-roughness.js.map","map":null,"metadata":{},"sourceType":"module"}